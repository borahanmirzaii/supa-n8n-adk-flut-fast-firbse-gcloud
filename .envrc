# direnv configuration - Auto-load environment variables
# Install: brew install direnv
# Setup: echo 'eval "$(direnv hook zsh)"' >> ~/.zshrc
# Trust: direnv allow

# Load mise environment (if mise is installed)
if command -v mise &> /dev/null; then
  eval "$(mise activate zsh)"
  echo "âœ… mise environment loaded"
fi

# Load environment variables from .env.local if it exists
if [ -f .env.local ]; then
  dotenv .env.local
  echo "âœ… Loaded .env.local"
fi

# Load Python environment variables
if [ -f apps/agents/.env ]; then
  export $(grep -v '^#' apps/agents/.env | xargs)
  echo "âœ… Loaded apps/agents/.env"
fi

# Set project-specific environment variables
export PROJECT_ROOT="$(pwd)"
export PYTHONPATH="${PROJECT_ROOT}/apps/agents:${PYTHONPATH}"

# Firebase Emulator settings (for local dev)
export FIRESTORE_EMULATOR_HOST="localhost:8081"
export FIREBASE_AUTH_EMULATOR_HOST="localhost:9099"
export FIREBASE_STORAGE_EMULATOR_HOST="localhost:9199"

# Development flags
export NODE_ENV="development"
export ENVIRONMENT="development"

# Docker/OrbStack settings (M4 Max optimized)
export DOCKER_BUILDKIT=1
export BUILDKIT_PROGRESS=plain
export COMPOSE_DOCKER_CLI_BUILD=1
export DOCKER_DEFAULT_PLATFORM=linux/arm64

# Node.js optimizations (M4 Max unified memory)
export NODE_OPTIONS="--max-old-space-size=8192 --experimental-specifier-resolution=node"

# Python optimizations
export PYTHONDONTWRITEBYTECODE=1
export PYTHON_PERF_JIT=1  # Python 3.13+ performance JIT

# Path additions
export PATH="${PROJECT_ROOT}/node_modules/.bin:${PATH}"

echo "ðŸš€ Development environment activated (M4 Max Optimized)"
echo "ðŸ“ Project: $(basename $(pwd))"
echo "ðŸ”§ Tools: Node $(node --version 2>/dev/null || echo 'not installed'), Python $(python3 --version 2>/dev/null || echo 'not installed')"
echo "ðŸŽ Platform: $(uname -m) ($(sysctl -n hw.ncpu 2>/dev/null || echo 'unknown') cores)"

